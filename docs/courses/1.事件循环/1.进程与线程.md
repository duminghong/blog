---
layoutClass: doc-layout
title: 事件循环-进程与线程
date: 2025-11-11 10:37:10
---

# 浏览器的进程与线程

浏览器采用多进程架构，每个标签页对应一个渲染进程，其他进程负责管理浏览器界面、用户交互、网络请求等。
每个进程包含多个线程，主要包括主线程、合成线程、工作线程、IO 线程等。

## 进程（Process）{#process}

进程是操作系统分配资源的基本单位，每个进程都有自己独立的内存空间。现代浏览器采用多进程架构，主要包含以下进程：

### 主进程（Browser Process）{#browser-process}

- 负责管理浏览器界面（地址栏、书签、前进后退按钮等）
- 处理用户交互事件（非页面内容相关）
- 管理所有其他进程的生命周期
- 处理文件访问、存储等系统级操作
- 协调各进程间的通信

### 网络进程（Network Process）{#network-process}

- 专门负责处理所有网络请求
- 管理 `HTTP`、`WebSocket` 等连接
- 处理资源加载、`DNS` 解析、缓存等网络操作
- 为所有渲染进程提供统一的网络服务

### 渲染进程（Renderer Process）{#renderer-process}

- 负责渲染网页内容（`HTML`、`CSS`、`JavaScript`）
- 每个标签页通常对应一个独立的渲染进程（站点隔离）
- 实现了沙箱隔离，提高安全性
- 包含主线程、合成线程、工作线程等

### GPU 进程（GPU Process）{#gpu-process}

- 负责处理 `GPU` 相关的任务
- 如 `3D` 渲染、硬件加速、`WebGL` 等
- 将渲染进程的输出合成并显示到屏幕上
- 为所有渲染进程提供统一的 GPU 服务

### 插件进程（Plugin Process）{#plugin-process}

- 负责运行浏览器插件（如 Flash、PDF 阅读器等）
- 独立运行，插件崩溃不会影响浏览器主体
- 实现插件与浏览器的隔离

### 扩展进程（Extension Process）{#extension-process}

- 负责运行浏览器扩展
- 与网页内容隔离，提高安全性
- 每个扩展可能运行在独立的进程中

### Service Worker 进程（Service Worker Process）{#service-worker-process}

- 负责运行 `Service Workers` 脚本
- 实现离线缓存、后台同步、推送通知等功能
- 独立于渲染进程运行，即使页面关闭也能继续工作
- 提供网络代理和请求拦截能力

### 实用程序进程（Utility Process）{#utility-process}

- 处理各种系统级任务
- 如网络服务、音频处理、视频编解码等
- 根据需要创建和销毁，提高资源利用效率

### 崩溃处理进程（Crash Handler Process）{#crash-handler-process}

- 监控其他进程的运行状态
- 处理进程崩溃情况
- 收集崩溃报告并上传（需用户同意）

## 线程（Thread）{#thread}

线程是 CPU 调度的基本单位，一个进程可以包含多个线程，它们共享进程的内存空间。浏览器的线程架构是跨进程协作的复杂系统，不同进程包含不同的线程。

### 渲染进程中的主要线程{#renderer-threads}

#### 渲染主线程（Main Thread）{#main-thread}

- 负责执行 `JavaScript` 代码
- 处理 `DOM` 操作、用户交互事件
- 解析 `HTML`、`CSS`，构建 `DOM` 树和 `CSSOM` 树
- 执行布局计算（Reflow）和绘制（Repaint）
- 执行 `requestAnimationFrame` 回调

#### 合成线程（Compositor Thread）{#compositor-thread}

- 负责将各个图层合成最终图像
- 处理滚动、缩放等操作
- 实现流畅的动画效果
- 接收主线程的绘制指令，管理图层

#### 光栅化线程（Raster Thread）{#raster-thread}

- 将图层转换为位图
- 通常利用 `GPU` 加速
- 在合成线程的协调下工作

#### 工作线程（Worker Threads）{#worker-threads}

- 用于执行 `Web Workers` 中的代码
- 在后台运行，不阻塞主线程
- 适合处理计算密集型任务

#### IO 线程（IO Thread）{#io-thread}

- 负责处理渲染进程与其他进程间的通信
- 接收来自浏览器进程的指令和数据
- 处理网络请求、文件读写等异步 IO 操作
- 将外部事件转换为内部消息，分发给对应线程

### 其他进程中的关键线程{#other-process-threads}

#### 网络进程中的线程{#network-threads}

- 负责处理网络请求（`HTTP`、`WebSocket` 等）
- 管理 `DNS` 解析
- 处理资源加载和缓存
- 与渲染进程通信，传递网络数据

#### GPU 进程中的线程{#gpu-threads}

- 负责处理 `GPU` 相关的任务
- 如 `3D` 渲染、硬件加速等
- 接收合成线程的指令，完成最终渲染

#### 数据库进程中的线程{#database-threads}

- 处理 `IndexedDB` 等本地数据库操作
- 避免阻塞主线程的数据库读写
- 提供异步数据存储能力

## 进程间通信（IPC）{#ipc}

浏览器中的各个进程需要相互协作，它们通过进程间通信（Inter-Process Communication, IPC）机制进行数据交换：

- **IPC 消息传递**：进程间通过消息传递进行通信，确保数据安全隔离
- **共享内存**：某些场景下使用共享内存提高通信效率
- **Mojo 系统**：现代浏览器（如 Chrome）使用 Mojo 系统处理进程间通信
- **安全限制**：进程间通信受到严格的安全限制，防止恶意代码传播

## 站点隔离（Site Isolation）{#site-isolation}

现代浏览器实现了站点隔离机制，这是多进程架构的重要特性：

- **不同站点不同进程**：来自不同站点的页面运行在不同的渲染进程中
- **安全边界**：有效防止恶意网站窃取其他网站的数据
- **内存开销**：会增加内存使用，但显著提高安全性
- **进程管理**：浏览器会根据站点关系智能分配和管理渲染进程

## 浏览器进程模型的多样性{#process-model-diversity}

不同浏览器和配置可能采用不同的进程模型，主要包括：

- **单进程模型**：早期浏览器（如 IE6）采用单进程架构，所有功能模块共享一个进程
- **多进程模型**：现代浏览器（如 Chrome、Edge）默认采用多进程架构
- **进程池模型**：为了平衡性能和内存开销，浏览器可能会限制进程数量，将多个标签页合并到同一进程
- **自适应进程模型**：根据设备性能、内存情况动态调整进程数量和分配策略

## 多进程多线程架构的优势{#multi-thread-advantage}

### 性能优化{#multi-thread-optimize}

- 并行处理提高资源利用率
- 避免单线程阻塞导致的页面卡顿
- 实现流畅的用户交互体验
- 渲染流程分解，实现流水线处理
- GPU 硬件加速提升渲染性能

### 安全隔离{#multi-thread-security}

- 渲染进程沙箱隔离，防止恶意代码影响系统
- 插件进程独立运行，插件崩溃不影响浏览器主体
- 不同标签页隔离，一个页面崩溃不影响其他页面
- 进程间通信受限，减少安全风险

### 资源管理{#multi-thread-resource}

- 按需分配资源，提高内存使用效率
- 后台标签页可被挂起，释放 `CPU` 资源
- GPU 进程统一管理图形资源，避免重复分配
- 网络进程统一管理网络连接，提高效率
- 数据库进程统一管理存储，避免数据竞争

### 可靠性与稳定性{#reliability-stability}

- 单个进程崩溃不会导致整个浏览器崩溃
- 进程间相互独立，便于错误隔离
- 可以单独重启崩溃的进程，不影响其他功能
- 便于实现进程级别的权限控制

## 最新架构变化{#latest-architecture-changes}

现代浏览器持续优化进程架构，主要包括：

- **Process Per Site Instance**：Chrome 引入的进程分配策略，同一站点的不同实例（如不同标签页）可能共享同一进程，提高资源利用率
- **Process Per Origin**：更精细的进程隔离策略，基于域名和协议的组合进行进程分配
- **Fission 架构**：Firefox 实现的站点隔离技术，将不同站点的内容完全隔离到不同进程
- **Sandbox 增强**：不断加强渲染进程的沙箱隔离，限制其对系统资源的访问
- **进程合并优化**：智能合并低优先级标签页的进程，减少内存占用
